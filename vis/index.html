<!DOCTYPE html>
<head>
    <link rel="icon" type="image/svg+xml" sizes="any" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>"/>

    <!-- <script src="src/d3.v7.min.js" type="text/javascript"></script> -->
    <script src="src/d3.v7.js" type="text/javascript"></script>
    
    <script src="src/vega.min.js"></script>
    <script src="src/vega-lite.min.js"></script>
    <script src="src/vega-embed.min.js"></script>
    <script src="inflect.js" type="text/javascript"></script>

    <link href="inflectstyle.css" type="text/css" rel="stylesheet">
    <!-- <link href='https://fonts.googleapis.com/css?family=Ubuntu:regular,bold' rel='stylesheet'> -->


</head>

<body>
    <div id="vis"> </div>
    <script type="text/javascript">
        // URL is of the form: http://localhost:8000/vis/index.html
        // define which vega-lite spec file to use by adding #vis=filename to the URL,
        // e.g. http://localhost:8000/vis/index.html#vis=barchart
        // the code searches for the filename.json file in the SPECS folder
        // if no vis is defined, barchart is default

        if(document.URL.split("#")[1]) {
            var hash_array = document.URL.split("#")[1].split("&");
            var which_definition = hash_array.find(function(d) {return d.includes("vis")})
            var spec = [];
            try {
                var chartPath = which_definition.split("=")[1]
            } catch (error) {
                console.warning("You forgot to define which visualisation to use!")
                var chartPath = "barchart"; //default
            }
        } else {
            var chartPath = "barchart"; //default
        }
    
        
        fetch('specs/' + chartPath + '.json') 
            .then(response => {return response.json()})
            .then(function(data) {
                    var spec = data;
                    
                    // find out if axis are quantitative or not, look at definition in spec
                    var x_encoding_type = spec.encoding.x.type
                    var x_aggregate = spec.encoding.x.aggregate
                    if(x_encoding_type === "quantitative" || x_encoding_type === "temporal" || x_aggregate) {
                        var x_quant = true;
                    } else { // nominal is default in vega-lite
                        var x_quant = false;
                    }

                    var y_encoding_type = spec.encoding.y.type
                    var y_aggregate = spec.encoding.y.aggregate
                    if(y_encoding_type === "quantitative" || y_encoding_type === "temporal" || y_aggregate) {
                        var y_quant = true;
                    } else {
                        var y_quant = false;
                    }
                    var dragable = false; //variable defines if plot area is dragable (e.g. for scatterplots and linecharts)
                    
                    if(x_quant && y_quant && (spec.mark == "point" || spec.mark == "circle" || spec.mark == "line" || spec.mark.type == "line")) {
                        var dragable = true;
                    } 

                    if(!spec.usermeta){
                        spec.usermeta = {"embedOptions": {"renderer": "svg"}}; //should be rendered as SVG and not Canvas
                    }

                    var result = vegaEmbed("#vis", spec, {mode: "vega-lite"}).then(
                        function() {
                            var vis;
                            vis = new Inflection();	
                            vis.init(chartPath, x_quant, y_quant, dragable); //initialize inflection from inflect.js
                        }
                    ).catch(console.error);
                }
            )   

        
        
    </script>


</body>

