<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inflectable YouTube Video</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #111;
      color: #fff;
      font-family: sans-serif;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #yt-iframe {
      width: 80vw;
      height: 45vw;
      max-width: 960px;
      max-height: 540px;
      min-width: 320px;
      min-height: 180px;
      background: #000;
      border: none;
      margin-bottom: 1em;
    }
    #controls {
      display: flex;
      gap: 1em;
      align-items: center;
    }
    #video-url {
      width: 300px;
      font-size: 1em;
      padding: 0.3em;
    }
    #play-pause {
      font-size: 1em;
      padding: 0.3em 1em;
    }
  </style>
</head>
<body>
  <div id="container">
    <iframe id="yt-iframe" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <div id="controls">
      <input id="video-url" type="text" placeholder="Paste YouTube URL...">
      <button id="load-url">Load</button>
      <button id="play-pause" disabled>Play</button>
    </div>
  </div>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const ytIframe = document.getElementById('yt-iframe');
    const urlInput = document.getElementById('video-url');
    const loadBtn = document.getElementById('load-url');
    const playPauseBtn = document.getElementById('play-pause');
    let ytPlayer = null;
    let ytReady = false;
    let pendingId = null;

    function getYouTubeId(url) {
      if (/^[\w-]{11}$/.test(url)) return url;
      const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/))([\w-]{11})/);
      return match ? match[1] : null;
    }
    function setHash(id) {
      if (id && location.hash.slice(1) !== id) location.hash = id;
    }
    function loadYouTube(id) {
      ytIframe.src = `https://www.youtube.com/embed/${id}?enablejsapi=1&origin=${location.origin}`;
    }
    function createPlayer(id) {
      ytPlayer = new YT.Player('yt-iframe', {
        events: {
          'onReady': function() {
            ytReady = true;
            playPauseBtn.disabled = false;
            if (pendingId && pendingId !== id) {
              ytPlayer.loadVideoById(pendingId);
              pendingId = null;
            }
          }
        }
      });
    }
    function setupPlayer(id) {
      playPauseBtn.disabled = true;
      ytReady = false;
      if (window.YT && YT.Player) {
        if (ytPlayer) {
          ytPlayer.loadVideoById(id);
          playPauseBtn.disabled = false;
          ytReady = true;
        } else {
          createPlayer(id);
        }
      } else {
        pendingId = id;
      }
    }
    function handleLoad() {
      const url = urlInput.value.trim();
      const id = getYouTubeId(url);
      if (!id) {
        alert('Invalid YouTube URL or ID');
        return;
      }
      setHash(id);
      loadYouTube(id);
      setupPlayer(id);
    }
    loadBtn.addEventListener('click', handleLoad);
    urlInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') handleLoad();
    });
    playPauseBtn.addEventListener('click', () => {
      if (!ytPlayer || typeof ytPlayer.getPlayerState !== 'function') return;
      const state = ytPlayer.getPlayerState();
      if (state !== 1) ytPlayer.playVideo();
      else ytPlayer.pauseVideo();
    });
    function handleHashOrLoad(id) {
      if (id && id.length === 11) {
        urlInput.value = `https://youtu.be/${id}`;
        loadYouTube(id);
        setupPlayer(id);
      }
    }
    window.addEventListener('hashchange', () => {
      const id = location.hash.slice(1);
      handleHashOrLoad(id);
    });
    window.addEventListener('DOMContentLoaded', () => {
      const id = location.hash.slice(1);
      handleHashOrLoad(id);
    });
    // YouTube API ready handler
    window.onYouTubeIframeAPIReady = function() {
      if (pendingId) {
        createPlayer(pendingId);
        pendingId = null;
      }
    };
  </script>
</body>
</html>
